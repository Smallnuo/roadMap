# ç®€å•å” å” ç»„ä»¶å¤ç”¨é‚£äº›äº‹

## é«˜é˜¶ç»„ä»¶HOC(higherOrderComponent)

> ğŸ“Œ é«˜é˜¶ç»„ä»¶æ˜¯Reactä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§æŠ€å·§ã€‚HOCè‡ªèº«ä¸æ˜¯React APIçš„ä¸€éƒ¨åˆ†ï¼Œä»–æ˜¯åŸºäºReactçš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼

é«˜é˜¶ç»„ä»¶æ˜¯**å‚æ•°ä¸ºç»„ä»¶**ï¼Œ**è¿”å›å€¼ä¸ºæ–°ç»„ä»¶çš„å‡½æ•°**

é«˜é˜¶ç»„ä»¶ä¸èƒ½å¤Ÿå»ä¿®æ”¹ä½œä¸ºå‚æ•°çš„ç»„ä»¶ï¼Œåº”æ˜¯ä¸€ä¸ª[çº¯å‡½æ•°](https://www.freecodecamp.org/news/what-is-a-pure-function-in-javascript-acb887375dfe/)ï¼Œä¸åº”è¯¥æœ‰å‰¯ä½œç”¨

é«˜é˜¶å‡½æ•°è¿”å›ç»“æœå¿…é¡»æ˜¯ä¸€ä¸ªæ–°çš„ React ç»„ä»¶ï¼Œæ–°ç»„ä»¶çš„ JSX è‚¯å®šåŒ…å«ä½œä¸ºå‚æ•°çš„ç»„ä»¶

```jsx
const EnhancedComponent = higherOrderComponent(WrappedComponent)
```

ç»„ä»¶æ˜¯å°† props è½¬æ¢æˆ UIï¼Œé«˜é˜¶ç»„ä»¶æ˜¯å°†ç»„ä»¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªç»„ä»¶

### å±æ€§ä»£ç†(Props Proxy)

**HOCæ“ä½œWrappedComponentçš„props**

```jsx
function PPHoc(WrappedComponent) {
    return class PP extends React.Component {
        render() {
            return <WrappedComponent {...this.props} />
        }
    }
}
```

- PP æ¨¡å¼çš„ä½œç”¨
    - æ“ä½œ propsï¼Œåœ¨ç»„ä»¶å†…éƒ¨å¯ä»¥æ“ä½œ propsï¼Œä¼ é€’ç»™ WrappedComponent ä¸€äº›æ–°çš„ props
        ```jsx
        function PPHoc(WrappedComponent) {
            return class PP extends React.Component {
                render() {
                    const newProps = { age: 18 };
                    return <WrappedComponent {...this.props} {...newProps} />;
                }
            };
        }
        ```

    - ref è®¿é—®ç»„ä»¶å®ä¾‹
        ```jsx
        function PPHoc(WrappedComponent) {
            return class PP extends React.Component {
                proc = (wrappedComponentInstance) => {
                    wrappedComponentInstance.name();
                };
                render() {
                    const props = Object.assign({}, this.props, { ref: this.proc }); // åˆå¹¶ props
                    return <WrappedComponent {...props} />;
                }
            };
        }

        class Example extends React.Component {
            name() {
                console.log("my name is Example");
            }
            render() {
                return (
                    <div>
                        <h2>Wrapped Component</h2>
                    </div>
                );
            }
        }

        const newExample = PPHoc(Example)
        ```

    - ç”¨å…¶ä½™å…ƒç´ åŒ…è£¹ WrappedComponent(æ¸²æŸ“åŠ«æŒ)
        ```jsx
        function PPHoc(WrappedComponent) {
            return class PP extends React.Component {
                render() {
                const { login } = this.props
                    return (
                        <div style={{ padding: '20px' }}>
                            {login ? <WrappedComponent {...this.props} /> : <NoPermission />
                        </div>
                    )
                }
            }
        }
        ```

### åå‘ç»§æ‰¿(Inheritance Inversion)

**HOCç»§æ‰¿WrappedComponent**ï¼Œå³è¿”å›çš„ç»„ä»¶ç»§æ‰¿ä¼ å…¥çš„å‚æ•°ç»„ä»¶

å…è®¸HOCé€šè¿‡superè®¿é—®åˆ°WrappedComponentï¼Œæ„å‘³ç€å®ƒå¯ä»¥è®¿é—®åˆ°stateã€propsã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å’Œrenderæ–¹æ³•

```jsx
function iiHOC(WrappedComponent) {
  return class Enhancer extends WrappedComponent {
    render() {
      return super.render()
    }
  }
}
```

- IIæ¨¡å¼çš„ä½œç”¨
    - æ¸²æŸ“åŠ«æŒ/æ¡ä»¶æ¸²æŸ“
        ```jsx
        function iiHOC(WrappedComponent) {
            return class Enhancer extends WrappedComponent {
                render() {
                    const { isLogin } = this.props
                    return isLogin ? super.render() : <Nopermission />
                }
            }
        }
        ```
| åœºæ™¯ | é€‰æ‹© |
| --- | --- |
| æ“ä½œç”Ÿå‘½å‘¨æœŸ | åå‘ç»§æ‰¿ |
| æ“ä½œpropsï¼Œä¼ é€’props | å±æ€§ä»£ç† |
| æ¸²æŸ“åŠ«æŒ | ä¸¤è€…éƒ½å¯ï¼Œè§†æƒ…å†µè€Œå®š |

### ç”¨é«˜é˜¶ç»„ä»¶æŠ½å–å…±åŒé€»è¾‘

[ç¤ºä¾‹](https://codesandbox.io/s/blog-example-r2ij0r)

### é“¾å¼è°ƒç”¨çš„é«˜é˜¶ç»„ä»¶

ä¸¤ä¸ªé«˜é˜¶ç»„ä»¶WithCountNumber/WithThemeï¼Œéœ€è¦åŒæ—¶ç”¨äºç»„ä»¶Componentä¸Šï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†ComponentæŒ¨ä¸ªåŒ…è£…ä¸€ä¸‹ã€‚[ç¤ºä¾‹](https://codesandbox.io/s/count-example-kqzdfn?file=/src/PatternExample.jsx)

```jsx
const CountComponent = WithCountNumber(Component)
const ThemeComponent = WithTheme(CountComponent)

const HocCountTheme = WithTheme(WithCountNumber(Count));
```

reduxä¸­çš„connectä½¿ç”¨å¦‚ä¸‹ï¼š

```jsx
const superComp = connect(mapStateToProps, mapDispatchToProps)(withRouter(ProjectPanel))

//connectæ˜¯ä¸€ä¸ªè¿”å›å‡½æ•°çš„å‡½æ•°
const enhance = connect(mapStateToProps, mapDispatchToProps)
//è¿”å›çš„å‡½æ•°enhanceæ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œå¯ä»¥æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°
const superComp = enhance(withRouter(ProjectPanel))
```

### ä½¿ç”¨é«˜é˜¶çš„æ³¨æ„ç‚¹

é«˜é˜¶ç»„ä»¶ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§å¯é‡ç”¨çš„æ–¹å¼æ‰©å……ç»„ä»¶çš„åŠŸèƒ½ï¼Œä½†æ˜¯é«˜é˜¶ç»„ä»¶å¹¶ä¸å®Œç¾ã€‚

1. æˆ‘ä»¬ä¸è¦åœ¨é«˜é˜¶ç»„ä»¶ä¸­ä¿®æ”¹ç»„ä»¶çš„åŸå‹

    ```jsx
    function logProps(Component) {
        Component.prototype.componentWillReceiveProps = function(nextProps){
    	    console.log('Current props: ', this.props);
    	    console.log('Next props: ', nextProps);
    	 };
      // æˆ‘ä»¬è¿”å›çš„åŸå§‹ç»„ä»¶å®é™…ä¸Šå·²ç»è¢«ä¿®æ”¹äº†
      return Component;
    }

    // EnhancedComponentä¼šè®°å½•ä¸‹æ‰€æœ‰çš„propså±æ€§
    const EnhancedComponent = logProps(InputComponent);
    ```

    è¯¥é«˜é˜¶ç»„ä»¶å¯¹å‡½æ•°ä¸ä¼šæœ‰ä½œç”¨ï¼Œå› ä¸ºå‡½æ•°ç»„ä»¶æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°

2. ç»™é«˜é˜¶ç»„ä»¶æ·»åŠ displayName

    éœ€è¦ç»™æ¯ä¸ªé«˜é˜¶ç»„ä»¶éƒ½æ·»åŠ ä¸Šä¸€ä¸ªdisplayNameå±æ€§ï¼Œå¦åˆ™åœ¨Reactæ¸²æŸ“å‡ºé”™æ—¶debugä¼šå¾ˆéº»çƒ¦ï¼Œéœ€è¦åˆ©ç”¨displayNameæ¥åˆ¤æ–­å‡ºé”™çš„ç»„ä»¶

3. åœ¨ä¹‹å‰æˆ‘ä»¬è®²äº†é“¾å¼è°ƒç”¨çš„é«˜é˜¶ç»„ä»¶ï¼Œå‡è®¾ä½¿ç”¨ä¸€é•¿ä¸²çš„é«˜é˜¶ç»„ä»¶ï¼Œä¼šæœ‰å¾ˆæ·±çš„è°ƒç”¨æ ˆ
4. ä¸è¦å†renderå‡½æ•°ä¸­ä½¿ç”¨é«˜é˜¶ç»„ä»¶

    ```jsx
    render() {
      const EnhancedComponent = enhance(MyComponent);
      return <EnhancedComponent />;
    }

    // å‡½æ•°å†™æ³•
    const Example = () => {
    	const EnhanceComponent = enhance(Component)
    	return <EnhanceComponent />
    }
    ```

    æ¯ä¸€æ¬¡renderå‡½æ•°è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„EnhancedComponentå®ä¾‹ï¼ŒEnhancedComponent1 !== EnhancedComponent2ã€‚å› ä¸ºåœ¨Reactçš„`diffç®—æ³•`ä¸­ï¼Œä¼šé€šè¿‡ç»„ä»¶æ ‡è¯†ç¬¦(component identity)æ¥åˆ¤æ–­æ˜¯æ›´æ–°å·²æœ‰ç»„ä»¶è¿˜æ˜¯å®‰è£…ä¸€ä¸ªæ–°çš„å­æ ‘ã€‚å‡è®¾renderæ—¶è¿”å›çš„ç»„ä»¶ç­‰äºä¹‹å‰çš„ç»„ä»¶ï¼Œé‚£ä¹ˆä¼šæ ¹æ®`diffç®—æ³•`æ›´æ–°å­æ ‘ï¼›å¦åˆ™ä¼šå°†ä¹‹å‰çš„å­æ ‘å®Œå…¨å¸è½½

    è¿™ç‚¹ä¸ä»…ä»…æ˜¯æ€§èƒ½ç›¸å…³ï¼Œå¸è½½ç»„ä»¶ä¼šé€ æˆç»„ä»¶çŠ¶æ€å’Œå­å…ƒç´ å…¨éƒ¨ä¸¢å¤±

    æ­£ç¡®çš„åšæ³•æ˜¯åœ¨ç»„ä»¶å¤–å®šä¹‰é«˜é˜¶ç»„ä»¶ï¼Œè¿™æ ·ç”Ÿæˆçš„ç»„ä»¶åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œç»„ä»¶æ ‡è¯†ç¬¦æ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯ç›¸åŒçš„

    ```jsx
    const EnhanceComponent = enhance(Component)
    const Example = () => {
    	return <EnhanceComponent />
    }
    ```

    ## render Props

    æƒ³ç†è§£ render Props çš„è¯ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹åœ¨åŸç”Ÿçš„ JavaScript ä¸­çš„ç¤ºä¾‹ã€‚

    ```jsx
    function sum(a, b){
    	const result = a + b;
    	console.log(result)
    }
    ```

    ä¼šæœ‰å¤šæ¬¡ä½¿ç”¨ sum å‡½æ•°çš„æƒ…å†µï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ› console.log æ˜¯å”¯ä¸€å¤„ç†ç»“æœçš„æ–¹å¼ï¼Œå¸Œæœ›èƒ½å¤Ÿåšåˆ°è°ƒç”¨è€…è‡ªå·±å†³å®š

    ```jsx
    function sum(a, b, fn){
    	const result = a + b;
    	fn(result)
    }
    sum(1, 2, (result) => console.log(result))
    sum(3, 4, (result) => alert(result))
    ```

    ç”¨å›è°ƒå‡½æ•°çš„æ–¹å¼è·å–ç»“æœï¼Œèƒ½å¤Ÿè‡ªç”±çš„åšå¯¹åº”å¤„ç†ã€‚

    React ç»„ä»¶çš„ props æ”¯æŒå‡½æ•°è¿™ç§å½¢å¼ï¼Œä½œä¸º props ä¼ å…¥çš„å‡½æ•°å¾€å¾€æ˜¯è¢«ç”¨æ¥æ¸²æŸ“ä¸€éƒ¨åˆ†ç•Œé¢ï¼Œæ‰€ä»¥è¢«ç§°ä¸º render propsã€‚

    ```jsx
    //å®šä¹‰ç»„ä»¶
    const Title = props => props.render('I am a render prop!')

    //ä½¿ç”¨ç»„ä»¶
    <Title render={(title) => <h1>{title}</h1>} />
    <Count><h1>{title}</h1></Count>

    const Title = props => props.showTitle()

    <Title showTitle={() => <h1>I am another render prop</h1>} />
    ```

    ä½¿ç”¨ Title ç»„ä»¶æ—¶ props ä¸Šä¼ å…¥ä¸€ä¸ª render å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªJSXã€‚åœ¨ Title ç»„ä»¶ä¸­æ¥æ”¶ props å¯¹è±¡ï¼Œç›´æ¥è¿”å› props.renderã€‚**ä»»ä½•ä¸€ä¸ªè¿”å›JSXå…ƒç´ çš„å‡½æ•°**å¯ä»¥è¢«ç§°ä¸ºrender propsã€‚åŒæ—¶ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ props.children çš„æ¥æ”¶ä¸€ä¸ªå‡½æ•°

    [blogç¤ºä¾‹çš„render propså†™æ³•](https://codesandbox.io/s/blog-example-r2ij0r?file=/src/RenderProps/index.jsx) 

    [countç¤ºä¾‹çš„render propså†™æ³•](https://codesandbox.io/s/count-example-kqzdfn?file=/src/PatternExample.jsx)

    ### hoc å’Œ render props åŒºåˆ«

    1. hoc åœ¨ä½¿ç”¨ä¹‹å‰éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„ç»„ä»¶å¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚render props æä¾›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°
    2. HOC ç›¸å¯¹äº render props æ¥è¯´ç»„åˆæ›´å®¹æ˜“ï¼Œå› ä¸ºæ¯ä¸ª render props éƒ½éœ€è¦æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œèƒ½å¤Ÿæ‹¿åˆ°å¯¹åº”çš„ propsï¼›ä½†æ˜¯ hoc ä¸èƒ½å¤Ÿç¡®å®š props æ¥è‡ªäºå“ªä¸ªé«˜é˜¶ç»„ä»¶
    3. ä½¿ç”¨ render props æ›´åŠ ç›´è§‚ï¼Œä¸ä¼šå‡ºç°å‘½åå†²çªçš„é—®é¢˜ï¼Œä½¿ç”¨ hoc åµŒå¥—æ—¶ï¼Œå¯èƒ½å‡ºç° props é‡åçš„æƒ…å†µ

    ## Hooks

    å½“æˆ‘ä»¬ç»™ç»„ä»¶æ·»åŠ å¾ˆå¤šé€»è¾‘çš„æ—¶å€™ï¼Œç»„ä»¶å¤§å°å°±ä¼šå¿«é€Ÿçš„å¢åŠ ï¼Œç»„ä»¶å†…éƒ¨çš„é€»è¾‘ä¼šå˜å¾—å¤æ‚ä¸”æ²¡æœ‰ç»“æ„æ€§

    ### è‡ªå®šä¹‰Hooksè§„åˆ™

    - åå­—æ˜¯ä»¥useå¼€å¤´çš„å‡½æ•°ï¼Œè¿™æ ·Reactæ‰çŸ¥é“è¯¥å‡½æ•°æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰Hook
    - å‡½æ•°å†…éƒ¨ä¸€å®šè°ƒç”¨äº†åˆ«çš„Hooksï¼Œå¯ä»¥æ˜¯å†…ç½®Hooksä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰Hooks

    [blogç¤ºä¾‹çš„hookså†™æ³•](https://codesandbox.io/s/blog-example-r2ij0r?file=/src/Hook/index.jsx)

    [countç¤ºä¾‹çš„hookså†™æ³•](https://codesandbox.io/s/count-example-kqzdfn?file=/src/PatternExample.jsx)

    ä½¿ç”¨React Hooksåªæ˜¯æ›´æ¸…æ¥šåœ°å°†æˆ‘ä»¬çš„ç»„ä»¶çš„é€»è¾‘åˆ†æˆå‡ ä¸ªè¾ƒå°çš„éƒ¨åˆ†ï¼Œé‡ç”¨ç›¸åŒçš„æœ‰çŠ¶æ€é€»è¾‘å˜å¾—æ›´åŠ å®¹æ˜“