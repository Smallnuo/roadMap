è¯¥æ–‡ç« åŒ…å«å¦‚ä¸‹å†…å®¹
-   å—æ§ä¸éå—æ§ç»„ä»¶
    -   éå—æ§ç»„ä»¶
    -   å—æ§ç»„ä»¶
-   å—æ§å’Œéå—æ§ç»„ä»¶è¾¹ç•Œ
-   åæ¨¡å¼
-   è§£å†³æ–¹æ¡ˆ

## å‰è¨€

åœ¨HTMLä¸­ï¼Œè¡¨å•å…ƒç´ (`<input>`/`<textarea>`/`<select>`)ï¼Œé€šå¸¸è‡ªå·±ä¼šç»´æŠ¤ stateï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œæ›´æ–°

```jsx
<form>
  <label>
    åå­—:
    <input type="text" name="name" />
  </label>
  <input type="submit" value="æäº¤" />
</form>
```

åœ¨è¿™ä¸ª HTML ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ input ä¸­éšæ„çš„è¾“å…¥å€¼ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è·å–åˆ°å½“å‰ input æ‰€è¾“å…¥çš„å†…å®¹ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

## å—æ§ä¸éå—æ§ç»„ä»¶

### éå—æ§ç»„ä»¶(uncontrolled component)

ä½¿ç”¨éå—æ§ç»„ä»¶ï¼Œä¸æ˜¯ä¸ºæ¯ä¸ªçŠ¶æ€æ›´æ–°ç¼–å†™æ•°æ®å¤„ç†å‡½æ•°ï¼Œè€Œæ˜¯å°†è¡¨å•æ•°æ®äº¤ç»™ DOM èŠ‚ç‚¹æ¥å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨ Ref æ¥è·å–æ•°æ®

åœ¨éå—æ§ç»„ä»¶ä¸­ï¼Œå¸Œæœ›èƒ½å¤Ÿèµ‹äºˆè¡¨å•ä¸€ä¸ªåˆå§‹å€¼ï¼Œä½†æ˜¯ä¸å»æ§åˆ¶åç»­çš„æ›´æ–°ã€‚å¯ä»¥é‡‡ç”¨`defaultValue`æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼

```jsx
class Form extends Component {
  handleSubmitClick = () => {
    const name = this._name.value;
    // do something with `name`
  }
  render() {
    return (
      <div>
        <input
          type="text"
          defaultValue="Bob"
          ref={input => this._name = input}
        />
        <button onClick={this.handleSubmitClick}>Sign up</button>
      </div>
    );
  }
}
```

### å—æ§ç»„ä»¶(controlled component)

åœ¨ React ä¸­ï¼Œå¯å˜çŠ¶æ€(mutable state)é€šå¸¸ä¿å­˜åœ¨ç»„ä»¶çš„ state å±æ€§ä¸­ï¼Œå¹¶ä¸”åªèƒ½å¤Ÿé€šè¿‡`setState` æ¥æ›´æ–°

```jsx
class NameForm extends React.Component {
  constructor(props) {
    super(props);
    this.state = {value: 'shuangxu'};
  }
  render() {
    return (
      <form onSubmit={this.handleSubmit}>
        <label>
          åå­—:
          <input type="text" value={this.state.value} />
        </label>
        <input type="submit" value="æäº¤" />
      </form>
    );
  }
}
```

åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œåœ¨ input è®¾ç½®äº† value å±æ€§å€¼ï¼Œå› æ­¤æ˜¾ç¤ºçš„å€¼å§‹ç»ˆä¸º`this.state.value`ï¼Œè¿™ä½¿å¾— state æˆä¸ºäº†å”¯ä¸€çš„æ•°æ®æºã€‚

```jsx
const handleChange = (event) => {
  this.setState({ value: event.target.value })
}

<input type="text" value={this.state.value} onChange={this.handleChange}/>
```

å¦‚æœæˆ‘ä»¬åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å†™å…¥`handleChange` æ–¹æ³•ï¼Œé‚£ä¹ˆæ¯æ¬¡æŒ‰é”®éƒ½ä¼šæ‰§è¡Œè¯¥æ–¹æ³•å¹¶ä¸”æ›´æ–° React çš„ stateï¼Œå› æ­¤è¡¨å•çš„å€¼å°†éšç€ç”¨æˆ·çš„è¾“å…¥è€Œæ”¹å˜

React ç»„ä»¶æ§åˆ¶ç€ç”¨æˆ·è¾“å…¥è¿‡ç¨‹ä¸­è¡¨å•å‘ç”Ÿçš„æ“ä½œå¹¶ä¸” state è¿˜æ˜¯å”¯ä¸€æ•°æ®æºï¼Œè¢« React ä»¥è¿™ç§æ–¹å¼æ§åˆ¶å–å€¼çš„è¡¨å•è¾“å…¥å…ƒç´ å«åšå—æ§ç»„ä»¶

> ğŸ“Œ å¯¹äºå—æ§ç»„ä»¶æ¥è¯´ï¼Œè¾“å…¥çš„å€¼å§‹ç»ˆç”±`React`çš„`state`é©±åŠ¨!!!

## å—æ§å’Œéå—æ§ç»„ä»¶è¾¹ç•Œ

### éå—æ§ç»„ä»¶

Inputç»„ä»¶åªæ¥æ”¶ä¸€ä¸ª`defaultValue`é»˜è®¤å€¼ï¼Œè°ƒç”¨ Input ç»„ä»¶çš„æ—¶å€™ï¼Œåªéœ€è¦é€šè¿‡ props ä¼ é€’ä¸€ä¸ª`defaultValue` å³å¯

```jsx
//ç»„ä»¶
function Input({defaultValue}){
  return <input defaultValue={defaultValue} />
}

//è°ƒç”¨
function Demo(){
  return <Input defaultValue='shuangxu' />
}
```

### å—æ§ç»„ä»¶

æ•°å€¼çš„å±•ç¤ºå’Œå˜æ›´éœ€è¦ç”±`state`å’Œ`setState`ï¼Œç»„ä»¶å†…éƒ¨æ§åˆ¶ stateï¼Œå¹¶å®ç°è‡ªå·±çš„ onChange æ–¹æ³•

```jsx
//ç»„ä»¶
function Input() {
  const [value, setValue] = useState('shuangxu')
  return <input value={value} onChange={e => setValue(e.target.value)} />;
}

//è°ƒç”¨
function Demo() {
  return <Input />;
}
```

è¯·é—®è¿™æ—¶ Input ç»„ä»¶æ˜¯å—æ§è¿˜æ˜¯éå—æ§ï¼Ÿå¦‚æœæˆ‘ä»¬é‡‡ç”¨ä¹‹å‰çš„å†™æ³•æ›´æ”¹è¿™ä¸ªç»„ä»¶ä»¥åŠå…¶è°ƒç”¨

```jsx
//ç»„ä»¶
function Input({defaultValue}) {
  const [value, setValue] = useState(defaultValue)
  return <input value={value} onChange={e => setValue(e.target.value)} />;
}

//è°ƒç”¨
function Demo() {
  return <Input defaultValue='shuangxu' />;
}
```

æ­¤æ—¶çš„ Input ç»„ä»¶æœ¬èº«æ˜¯ä¸€ä¸ªå—æ§ç»„ä»¶ï¼Œå®ƒæ˜¯ç”±å”¯ä¸€çš„ state æ•°æ®é©±åŠ¨çš„ã€‚ä½†æ˜¯å¯¹äº Demo æ¥è¯´ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ Input ç»„ä»¶çš„ä¸€ä¸ªæ•°æ®å˜æ›´æƒåˆ©ï¼Œé‚£ä¹ˆå¯¹äº Demo ç»„ä»¶æ¥è¯´ï¼ŒInput ç»„ä»¶å°±æ˜¯ä¸€ä¸ªéå—æ§ç»„ä»¶ã€‚(`â€¼ï¸ä»¥éå—æ§ç»„ä»¶çš„æ–¹å¼å»è°ƒç”¨å—æ§ç»„ä»¶æ˜¯ä¸€ç§åæ¨¡å¼`)

å¦‚ä½•ä¿®æ”¹å½“å‰çš„ Input å’Œ Demo ç»„ä»¶ä»£ç ï¼Œæ‰èƒ½å¤Ÿä½¿å¾— Input ç»„ä»¶æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå—æ§ç»„ä»¶ï¼Œå¹¶ä¸”å¯¹äº Demo ç»„ä»¶æ¥è¯´å®ƒä¹Ÿæ˜¯å—æ§çš„è®·ï¼Ÿ

```jsx
function Input({value, onChange}){
  return <input value={value} onChange={onChange} />
}

function Demo(){
  const [value, setValue] = useState('shuangxu')
  return <Input value={value} onChange={e => setValue(e.target.value)} />
}
```

> ğŸ“Œ å—æ§ä»¥åŠéå—æ§ç»„ä»¶çš„è¾¹ç•Œåˆ’åˆ†å–å†³äº`å½“å‰ç»„ä»¶å¯¹äºå­ç»„ä»¶å€¼çš„å˜æ›´æ˜¯å¦æ‹¥æœ‰æ§åˆ¶æƒ`ã€‚å¦‚æœæ‹¥æœ‰æ§åˆ¶æƒåˆ©å­ç»„ä»¶å¯¹äºå½“å‰ç»„ä»¶æ¥è¯´æ˜¯å—æ§çš„ï¼›åä¹‹åˆ™æ˜¯éå—æ§ã€‚


## åæ¨¡å¼-ä»¥éå—æ§ç»„ä»¶çš„æ–¹å¼å»è°ƒç”¨å—æ§ç»„ä»¶

è™½ç„¶å—æ§å’Œéå—æ§é€šå¸¸ç”¨æ¥æŒ‡å‘è¡¨å•çš„ inputsï¼Œä¹Ÿèƒ½ç”¨æ¥æè¿°æ•°æ®é¢‘ç¹æ›´æ–°çš„ç»„ä»¶ã€‚

é€šè¿‡ä¸Šä¸€èŠ‚å—æ§ä¸éå—æ§ç»„ä»¶çš„è¾¹ç•Œåˆ’åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„åˆ†ç±»ä¸ºï¼š

- å¦‚æœä½¿ç”¨ props ä¼ å…¥æ•°æ®ï¼Œæœ‰å¯¹åº”çš„æ•°æ®å¤„ç†æ–¹æ³•ï¼Œç»„ä»¶å¯¹äºçˆ¶çº§æ¥è¯´è®¤ä¸ºæ˜¯å¯æ§çš„
- æ•°æ®åªæ˜¯ä¿å­˜åœ¨ç»„ä»¶å†…éƒ¨çš„ state ä¸­ï¼Œç»„ä»¶å¯¹äºçˆ¶çº§æ¥è¯´æ˜¯éå—æ§çš„

**â‰ï¸ä»€ä¹ˆæ˜¯æ´¾ç”Ÿstate**

ç®€å•æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªç»„ä»¶çš„ state ä¸­çš„æŸä¸ªæ•°æ®æ¥è‡ªå¤–éƒ¨ï¼Œå°±å°†è¯¥æ•°æ®ç§°ä¹‹ä¸ºæ´¾ç”ŸçŠ¶æ€ã€‚
å¤§éƒ¨åˆ†ä½¿ç”¨æ´¾ç”Ÿ state å¯¼è‡´çš„é—®é¢˜ï¼Œä¸å¤–ä¹ä¸¤ä¸ªåŸå› ï¼š
- ç›´æ¥å¤åˆ¶ props åˆ° state
- å¦‚æœ props å’Œ state ä¸ä¸€è‡´å°±æ›´æ–° state

### ç›´æ¥å¤åˆ¶propåˆ°state

`getDerivedStateFromProps`å’Œ`componentWillReceiveProps`çš„æ‰§è¡Œæ—¶æœŸ
    åœ¨çˆ¶çº§é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¸ç®¡ props æ˜¯å¦æœ‰å˜åŒ–ï¼Œè¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½ä¼šæ‰§è¡Œ

æ‰€ä»¥åœ¨ä¸¤ä¸ªæ–¹æ³•é‡Œé¢ç›´æ¥å¤åˆ¶ props åˆ° state æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´ state æ²¡æœ‰æ­£ç¡®æ¸²æŸ“

```jsx
class EmailInput extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      email: this.props.email   //åˆå§‹å€¼ä¸ºpropsä¸­email
    };
  }
  componentWillReceiveProps(nextProps) {
    this.setState({ email: nextProps.email });   //æ›´æ–°æ—¶ï¼Œé‡æ–°ç»™stateèµ‹å€¼
  }
  handleChange = (e) => {
    this.setState({ email: e.target.value });
  };
  render() {
    const { email } = this.state;
    return <input value={email} onChange={this.handleChange} />;
  }
}
```

[ç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹](https://codesandbox.io/s/condescending-jasper-mdewk?file=/src/App.js)

ç»™ input è®¾ç½® props ä¼ æ¥çš„åˆå§‹å€¼ï¼Œåœ¨ input è¾“å…¥æ—¶å®ƒä¼šä¿®æ”¹stateã€‚ä½†æ˜¯å¦‚æœçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œè¾“å…¥æ¡† input çš„å€¼å°±ä¼šä¸¢å¤±ï¼Œå˜æˆ props çš„é»˜è®¤å€¼

å³ä½¿æˆ‘ä»¬åœ¨é‡ç½®å‰æ¯”è¾ƒ`nextProps.email!==this.state.email`ä»ç„¶ä¼šå¯¼è‡´æ›´æ–°

é’ˆå¯¹äºç›®å‰è¿™ä¸ªå° demo æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨`shouldComponentUpdate`æ¥æ¯”è¾ƒ props ä¸­çš„ email æ˜¯å¦ä¿®æ”¹å†æ¥å†³å®šæ˜¯å¦éœ€è¦é‡æ–°æ¸²æŸ“ã€‚ä½†æ˜¯å¯¹äºå®é™…åº”ç”¨æ¥è¯´ï¼Œè¿™ç§å¤„ç†æ–¹å¼å¹¶ä¸å¯è¡Œï¼Œä¸€ä¸ªç»„ä»¶ä¼šæ¥æ”¶å¤šä¸ª propï¼Œä»»ä½•ä¸€ä¸ª prop çš„æ”¹å˜éƒ½ä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“å’Œä¸æ­£ç¡®çš„çŠ¶æ€é‡ç½®ã€‚åŠ ä¸Šè¡Œå†…å‡½æ•°å’Œå¯¹è±¡ propï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨å¯é çš„`shouldComponentUpdate`ä¼šå˜å¾—è¶Šæ¥è¶Šéš¾ã€‚`shouldComponentUpdate`è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ›´å¤šæ˜¯ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œè€Œä¸æ˜¯å¤„ç†æ´¾ç”Ÿ stateã€‚

æˆªæ­¢è¿™é‡Œï¼Œè®²æ¸…**ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥å¤åˆ¶ prop åˆ° state**ã€‚æ€è€ƒå¦ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåªä½¿ç”¨ props ä¸­çš„ email å±æ€§æ›´æ–°ç»„ä»¶è®·ï¼Ÿ

### åœ¨propså˜åŒ–åä¿®æ”¹state

æ¥ç€ä¸Šè¿°ç¤ºä¾‹ï¼Œåªä½¿ç”¨`props.email`æ¥æ›´æ–°ç»„ä»¶ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä¿®æ”¹ state å¯¼è‡´çš„ bug

```jsx
class EmailInput extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      email: this.props.email   //åˆå§‹å€¼ä¸ºpropsä¸­email
    };
  }
  componentWillReceiveProps(nextProps) {
    if(nextProps.email !== this.props.email){
      this.setState({ email: nextProps.email });   //emailæ”¹å˜æ—¶ï¼Œé‡æ–°ç»™stateèµ‹å€¼
    }
  }
  //...
}
```

é€šè¿‡è¿™ä¸ªæ”¹é€ ï¼Œç»„ä»¶åªæœ‰åœ¨ props.email æ”¹å˜æ—¶æ‰ä¼šé‡æ–°ç»™ state èµ‹å€¼ï¼Œé‚£è¿™æ ·æ”¹é€ ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

åœ¨ä¸‹åˆ—åœºæ™¯ä¸­ï¼Œå¯¹æ‹¥æœ‰ä¸¤ä¸ªç›¸åŒ email çš„è´¦å·è¿›è¡Œåˆ‡æ¢çš„æ—¶ï¼Œè¿™ä¸ªè¾“å…¥æ¡†ä¸ä¼šé‡ç½®ï¼Œå› ä¸ºçˆ¶ç»„ä»¶ä¼ æ¥çš„ prop å€¼æ²¡æœ‰ä»»ä½•å˜åŒ–

[ç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹](https://codesandbox.io/s/prop-change-lvh32?file=/src/App.js)

è¿™ä¸ªåœºæ™¯æ˜¯æ„å»ºå‡ºæ¥çš„ï¼Œå¯èƒ½è®¾è®¡å¥‡æ€ªï¼Œä½†æ˜¯è¿™æ ·å­çš„é”™è¯¯å¾ˆå¸¸è§ã€‚å¯¹äºè¿™ç§åæ¨¡å¼æ¥è¯´ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆå¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚å…³é”®åœ¨äºï¼Œ**ä»»ä½•æ•°æ®ï¼Œéƒ½è¦ä¿è¯åªæœ‰ä¸€ä¸ªæ•°æ®æ¥æºï¼Œè€Œä¸”é¿å…ç›´æ¥å¤åˆ¶å®ƒã€‚**

## è§£å†³æ–¹æ¡ˆ

### å®Œå…¨å¯æ§çš„ç»„ä»¶

ä» EmailInput ç»„ä»¶ä¸­åˆ é™¤ stateï¼Œç›´æ¥ä½¿ç”¨ props æ¥è·å–å€¼ï¼Œå°†å—æ§ç»„ä»¶çš„æ§åˆ¶æƒäº¤ç»™çˆ¶ç»„ä»¶ã€‚

```jsx
function EmailInput(props){
  return <input onChange={props.onChange} value={props.email}/>
}
```

å¦‚æœæƒ³è¦ä¿å­˜ä¸´æ—¶çš„å€¼ï¼Œéœ€è¦çˆ¶ç»„ä»¶æ‰‹åŠ¨æ‰§è¡Œä¿å­˜ã€‚

### æœ‰keyçš„éå—æ§ç»„ä»¶

è®©ç»„ä»¶å­˜å‚¨ä¸´æ—¶çš„ email stateï¼Œemail çš„åˆå§‹å€¼ä»ç„¶æ˜¯é€šè¿‡ prop æ¥æ¥å—çš„ï¼Œä½†æ˜¯æ›´æ”¹ä¹‹åçš„å€¼å°±å’Œ prop æ²¡æœ‰å…³ç³»äº†

```jsx
function EmailInput(props){
  const [email, setEmail] = useState(props.email)
  return <input value={email} onChange={(e) => setEmail(e.target.value)}/>
}
```

åœ¨ä¹‹å‰çš„åˆ‡æ¢è´¦å·çš„ç¤ºä¾‹ä¸­ï¼Œä¸ºäº†åœ¨ä¸åŒé¡µé¢åˆ‡æ¢ä¸åŒçš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨`key`è¿™ä¸ªReactç‰¹æ®Šå±æ€§ã€‚å½“ key å˜åŒ–æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶è€Œä¸æ˜¯ç®€å•çš„æ›´æ–°å­˜åœ¨çš„ç»„ä»¶([è·å–æ›´å¤š](https://zh-hans.reactjs.org/docs/reconciliation.html#keys))ã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨åœ¨æ¸²æŸ“åŠ¨æ€åˆ—è¡¨æ—¶ä½¿ç”¨ key å€¼ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚

```html
<EmailInput
  email={account.email}
  key={account.id}
/>
```

[ç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹](https://codesandbox.io/s/use-key-9twve?file=/src/App.js)

æ¯æ¬¡ id æ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»º`EmailInput`ï¼Œå¹¶å°†å…¶çŠ¶æ€é‡ç½®ä¸ºæœ€è¿‘ email å€¼ã€‚

### å¯é€‰æ–¹æ¡ˆ

1. ä½¿ç”¨ key å±æ€§æ¥åšï¼Œä¼šä½¿ç»„ä»¶æ•´ä¸ªç»„ä»¶çš„ state éƒ½é‡ç½®ã€‚å¯ä»¥åœ¨`getDerivedStateFromProps`å’Œ`componentWillReceiveProps` æ¥è§‚å¯Ÿ id çš„å˜åŒ–ï¼Œéº»çƒ¦ä½†æ˜¯å¯è¡Œ

    ```jsx
    class EmailInput extends Component {
      state = {
        email: this.props.email,
        prevId: this.props.id
      };

      componentWillReceiveProps(nextProps) {
        const { prevId } = this.state;
        if (nextProps.id !== prevId) {
          this.setState({
            email: nextProps.email,
            prevId: nextProps.id
          });
        }
      }
      // ...
    }
    ```

    [ç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹](https://codesandbox.io/s/use-componentwillreceiveprops-wovjf?file=/src/App.js)

2. ä½¿ç”¨å®ä¾‹æ–¹æ³•é‡ç½®éå—æ§ç»„ä»¶

    åˆšåˆšä¸¤ç§æ–¹å¼ï¼Œå‡æ˜¯å†æœ‰å”¯ä¸€æ ‡è¯†å€¼çš„æƒ…å†µä¸‹ã€‚å¦‚æœåœ¨æ²¡æœ‰åˆé€‚çš„`key`å€¼æ—¶ï¼Œä¹Ÿæƒ³è¦é‡æ–°åˆ›å»ºç»„ä»¶ã€‚ç¬¬ä¸€ç§æ–¹æ¡ˆå°±æ˜¯ç”Ÿæˆéšæœºå€¼æˆ–è€…é€’å¢çš„å€¼å½“ä½œ`key`å€¼ï¼Œå¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ç¤ºä¾‹æ–¹æ³•å¼ºåˆ¶é‡ç½®å†…éƒ¨çŠ¶æ€

    ```jsx
    class EmailInput extends Component {
      state = {
        email: this.props.email
      };

      resetEmailForNewUser(newEmail) {
        this.setState({ email: newEmail });
      }

      // ...
    }
    ```

    çˆ¶ç»„ä»¶ä½¿ç”¨ [ref](https://zh-hans.reactjs.org/docs/glossary.html#refs) è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œ[ç‚¹å‡»æŸ¥çœ‹ç¤ºä¾‹](https://codesandbox.io/s/use-ref-cmfw0?file=/src/App.js)

## é‚£æˆ‘ä»¬å¦‚ä½•é€‰ï¼Ÿ

åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œå°½é‡é€‰æ‹©å—æ§ç»„ä»¶ï¼Œå‡å°‘ä½¿ç”¨æ´¾ç”Ÿ stateï¼Œè¿‡é‡çš„ä½¿ç”¨`componentWillReceiveProps`å¯èƒ½å¯¼è‡´ props åˆ¤æ–­ä¸å¤Ÿå®Œå–„ï¼Œå€’æ˜¯é‡å¤æ¸²æŸ“æ­»å¾ªç¯é—®é¢˜ã€‚

åœ¨ç»„ä»¶åº“å¼€å‘ä¸­ï¼Œä¾‹å¦‚ antdï¼Œå°†å—æ§ä¸éå—æ§çš„è°ƒç”¨æ–¹å¼éƒ½å¼€æ”¾ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·è‡ªä¸»é€‰æ‹©å¯¹åº”çš„è°ƒç”¨æ–¹å¼ã€‚æ¯”å¦‚ Form ç»„ä»¶ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨`getFieldDecorator`å’Œ`initialValue`æ¥å®šä¹‰è¡¨å•é¡¹ï¼Œä½†æ˜¯æˆ‘ä»¬æ ¹æœ¬ä¸å…³å¿ƒä¸­é—´çš„è¾“å…¥è¿‡ç¨‹ï¼Œåœ¨æœ€åæäº¤çš„æ—¶å€™é€šè¿‡`getFieldsValue`æˆ–è€…`validateFields`æ‹¿åˆ°æ‰€æœ‰çš„è¡¨å•å€¼ï¼Œè¿™å°±æ˜¯éå—æ§çš„è°ƒç”¨æ–¹å¼ã€‚æˆ–è€…æ˜¯ï¼Œæˆ‘ä»¬åœ¨åªæœ‰ä¸€ä¸ª Input çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»‘å®š value å’Œ onChange äº‹ä»¶ï¼Œè¿™ä¹Ÿå°±æ˜¯å—æ§çš„æ–¹å¼è°ƒç”¨ã€‚

## æ€»ç»“

åœ¨æœ¬æ–‡ä¸­ï¼Œé¦–å…ˆä»‹ç»äº†éå—æ§ç»„ä»¶å’Œå—æ§ç»„ä»¶çš„æ¦‚å¿µã€‚å¯¹äºå—æ§ç»„ä»¶æ¥è¯´ï¼Œç»„ä»¶æ§åˆ¶ç”¨æˆ·è¾“å…¥çš„è¿‡ç¨‹ä»¥åŠ state æ˜¯å—æ§ç»„ä»¶å”¯ä¸€çš„æ•°æ®æ¥æºã€‚

æ¥ç€ä»‹ç»äº†ç»„ä»¶çš„è°ƒç”¨é—®é¢˜ï¼Œå¯¹äºç»„ä»¶è°ƒç”¨æ–¹è€Œè¨€ï¼Œç»„ä»¶æä¾›æ–¹æ˜¯å¦ä¸ºå—æ§ç»„ä»¶ã€‚å¯¹äºè°ƒç”¨æ–¹è€Œè¨€ï¼Œç»„ä»¶å—æ§ä»¥åŠéå—æ§çš„è¾¹ç•Œåˆ’åˆ†å–å†³äºå½“å‰ç»„ä»¶å¯¹äºå­ç»„ä»¶å€¼çš„å˜æ›´æ˜¯å¦æ‹¥æœ‰æ§åˆ¶æƒã€‚

æ¥ç€ä»‹ç»äº†ä»¥éå—æ§ç»„ä»¶çš„æ–¹å¼è°ƒç”¨å—æ§ç»„ä»¶è¿™ç§åæ¨¡å¼ç”¨æ³•ï¼Œä»¥åŠç›¸å…³ç¤ºä¾‹ã€‚ä¸è¦ç›´æ¥å¤åˆ¶ props åˆ° stateï¼Œè€Œæ˜¯ä½¿ç”¨å—æ§ç»„ä»¶ã€‚å¯¹äºä¸å—æ§çš„ç»„ä»¶ï¼Œå½“ä½ æƒ³åœ¨ prop å˜åŒ–æ—¶é‡ç½® state çš„è¯ï¼Œå¯ä»¥é€‰æ‹©ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

- å»ºè®®: ä½¿ç”¨`key`å±æ€§ï¼Œé‡ç½®å†…éƒ¨æ‰€æœ‰çš„åˆå§‹ state
- é€‰é¡¹ä¸€ï¼šä»…æ›´æ”¹æŸäº›å­—æ®µï¼Œè§‚å¯Ÿç‰¹æ®Šå±æ€§çš„å˜åŒ–(å…·æœ‰å”¯ä¸€æ€§çš„å±æ€§)
- é€‰é¡¹äºŒï¼šä½¿ç”¨`ref`è°ƒç”¨å®ä¾‹æ–¹æ³•

æœ€åæ€»ç»“äº†ä¸€ä¸‹ï¼Œåº”å½“å¦‚ä½•é€‰æ‹©å—æ§ç»„ä»¶è¿˜æ˜¯éå—æ§ç»„ä»¶ã€‚

> å‚è€ƒé“¾æ¥
>
- [Reactå®˜ç½‘â€”â€”å—æ§ç»„ä»¶](https://zh-hans.reactjs.org/docs/forms.html#controlled-components)
- [Reactå®˜ç½‘â€”â€”éå—æ§ç»„ä»¶](https://zh-hans.reactjs.org/docs/uncontrolled-components.html)
- [controlled vs. uncontrolled form inputs](https://goshacmd.com/controlled-vs-uncontrolled-inputs-react/)
- [Transitioning from uncontrolled inputs to controlled](https://goshacmd.com/turn-uncontrolled-into-controlled/)
- [é‡æ–°è®¤è¯†å—æ§éå—æ§ç»„ä»¶](http://muyunyun.cn/blog/56hn38ez/)
- [ä½ å¯èƒ½ä¸éœ€è¦ä½¿ç”¨æ´¾ç”Ÿstate](https://zh-hans.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#when-to-use-derived-state)
